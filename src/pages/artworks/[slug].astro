---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { render } from 'astro:content';

export async function getStaticPaths() {
	const artworks = await getCollection('artworks');
	return artworks.map((artwork) => ({
		params: { slug: artwork.data.slug },
		props: { artwork },
	}));
}

const { artwork } = Astro.props;
const { Content } = await render(artwork);

function getImageUrl(imagePath: string) {
	const filename = imagePath.replace('./', '');
	return `/artworks/${artwork.data.slug}/${filename}`;
}

const images = artwork.data.images.map(getImageUrl);
const mainImage = images[0];

const specs = [
	{ label: 'Type', value: 'Hand-Signed, Unique Original' },
	{ label: 'Size', value: artwork.data.dimensions },
	{ label: 'Reference', value: artwork.data.reference },
	{ label: 'Plotter', value: 'Custom made Pen Plotter' },
	{ label: 'Ink type', value: artwork.data.technique },
	{ label: 'Materials', value: artwork.data.materials },
	{ label: 'Year', value: artwork.data.year },
].filter(spec => spec.value);

const isSoldOut = artwork.data.status === 'sold';
---

<Layout title={`${artwork.data.title} - Targz ART`}>
	<main class="min-h-screen bg-[#fafafa]">
		<div class="max-w-[1000px] mx-auto px-4 md:px-8 py-8 md:py-12">
			<div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-16">
				<!-- Image Gallery Section -->
				<div>
					<!-- Main Image -->
					<div class="bg-[#fafafa]">
						<img
							id="main-image"
							src={mainImage}
							alt={artwork.data.title}
							class="w-full h-auto max-h-[75vh] object-contain"
						/>
					</div>
				</div>

				<!-- Product Info Section -->
				<div class="lg:pt-4">
					<!-- Header -->
					<div class="mb-4">
						<p class="text-sm text-gray-500 mb-1">Targz Shop</p>
						<p class="text-sm text-gray-900 font-bold mb-4">Original Pen-Plotted Artwork</p>
						<h1 class="font-heading text-[40px] font-normal leading-tight mb-4">{artwork.data.title}</h1>
					</div>

					<!-- Description -->
					<div class="text-gray-500 text-sm leading-relaxed mb-6">
						<Content />
					</div>

					<!-- Specifications -->
					{specs.length > 0 && (
						<div class="mb-8">
							<dl class="space-y-0.5 text-sm">
								{specs.map((spec) => (
									<div class="flex">
										<dt class="font-bold text-gray-900">{spec.label}:</dt>
										<dd class="font-normal text-gray-600 ml-1">{spec.value}</dd>
									</div>
								))}
							</dl>
						</div>
					)}

					<!-- Price Section -->
					<div class="mb-2">
						<div class="flex items-center gap-3 mb-1">
							<span class="text-2xl font-normal tracking-tight">&euro;{artwork.data.price.toFixed(2).replace('.', ',')} EUR</span>
							{isSoldOut && (
								<span class="bg-gray-800 text-white text-xs px-2.5 py-1 rounded-sm font-medium">Sold out</span>
							)}
						</div>
						<p class="text-sm text-gray-500">
							Taxes included. <a href="#" class="underline hover:text-gray-700">Shipping</a> calculated at checkout.
						</p>
					</div>

					<!-- Buy Button -->
					<div class="mt-4 mb-6">
						{!isSoldOut ? (
							<button
								id="buy-button"
								class="w-full bg-gray-900 text-white py-4 px-8 text-sm font-medium rounded hover:bg-gray-800 transition-colors"
							>
								Add to cart
							</button>
						) : (
							<button
								disabled
								class="w-full bg-gray-200 text-gray-500 py-4 px-8 text-sm font-medium rounded cursor-not-allowed"
							>
								Sold out
							</button>
						)}
					</div>

					<!-- Share Button -->
					<button class="inline-flex items-center gap-2 text-sm text-gray-600 hover:text-gray-900 transition-colors">
						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
							<path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
							<polyline points="16 6 12 2 8 6"/>
							<line x1="12" y1="2" x2="12" y2="15"/>
						</svg>
						Share
					</button>
				</div>
			</div>

			<!-- Additional Images Gallery Below -->
			{images.length > 1 && (
				<div class="mt-12 grid grid-cols-2 gap-4 max-w-[600px]">
					{images.slice(1).map((img, index) => (
						<div class="bg-[#fafafa]">
							<img
								src={img}
								alt={`${artwork.data.title} - Image ${index + 2}`}
								class="w-full h-auto object-contain"
							/>
						</div>
					))}
				</div>
			)}
		</div>
	</main>
</Layout>

